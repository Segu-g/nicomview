import{j as d,L as e,c as s}from"./style.js";function r(){return d.jsxs(e,{title:"PSD アバター",children:[d.jsx("h1",{children:"PSD アバタープラグイン"}),d.jsxs("section",{children:[d.jsx("h2",{children:"概要"}),d.jsx("p",{children:"PSD ファイルを使って 2D アバターを表示するプラグインです。 VOICEVOX でコメントを読み上げながら、音声に合わせた口パクと自動目パチを行います。"}),d.jsxs("ul",{children:[d.jsx("li",{children:"PSD レイヤーを Canvas に合成して描画（z-order 完全再現）"}),d.jsx("li",{children:"目パチアニメーション（間隔・速度を設定可能）"}),d.jsx("li",{children:"VOICEVOX 読み上げに連動した口パク（開口・閉口アニメーション）"}),d.jsx("li",{children:"各フレームに複数レイヤーを同時割当可能"}),d.jsxs("li",{children:["PSDTool 互換の命名規則（",d.jsx("code",{children:"!"})," / ",d.jsx("code",{children:"*"})," / ",d.jsx("code",{children:":flipx"})," など）"]})]}),d.jsxs("div",{className:"note",children:[d.jsx("strong",{children:"必要なもの:"})," VOICEVOX が起動している必要があります。"," ",d.jsx("a",{href:"https://voicevox.hiroshiba.jp/",children:"公式サイト"})," からダウンロードできます。"]})]}),d.jsxs("section",{children:[d.jsx("h2",{children:"PSD ファイルの準備"}),d.jsxs("p",{children:["PSD ファイルはプラグインディレクトリの ",d.jsx("code",{children:"models/"})," ","フォルダに配置します。レイヤー名・グループ名に特殊文字を付けることで動作を制御できます。 これらは ",d.jsx("a",{href:"https://oov.github.io/psdtool/manual.html#original-feature",children:"PSDTool の命名規則"})," と互換性があります。"]}),d.jsx("h3",{children:"命名規則"}),d.jsxs("table",{children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{children:"記号"}),d.jsx("th",{children:"位置"}),d.jsx("th",{children:"対象"}),d.jsx("th",{children:"効果"}),d.jsx("th",{children:"例"})]})}),d.jsxs("tbody",{children:[d.jsxs("tr",{children:[d.jsx("td",{children:d.jsx("code",{children:"!"})}),d.jsx("td",{children:"先頭"}),d.jsx("td",{children:"レイヤー / グループ"}),d.jsx("td",{children:"常に表示（設定 UI での非表示切り替え不可）"}),d.jsx("td",{children:d.jsx("code",{children:"!body"})})]}),d.jsxs("tr",{children:[d.jsx("td",{children:d.jsx("code",{children:"*"})}),d.jsx("td",{children:"先頭"}),d.jsx("td",{children:"レイヤー / グループ"}),d.jsx("td",{children:"ラジオ選択（同一親グループ内で 1 つのみ表示）"}),d.jsx("td",{children:d.jsx("code",{children:"*outfit_a"})})]}),d.jsxs("tr",{children:[d.jsx("td",{children:d.jsx("code",{children:":flipx"})}),d.jsx("td",{children:"末尾"}),d.jsx("td",{children:"レイヤー / グループ"}),d.jsx("td",{children:"左右反転が有効なときのみ表示（通常版を置き換え）"}),d.jsx("td",{children:d.jsx("code",{children:"hair:flipx"})})]}),d.jsxs("tr",{children:[d.jsx("td",{children:d.jsx("code",{children:":flipy"})}),d.jsx("td",{children:"末尾"}),d.jsx("td",{children:"レイヤー / グループ"}),d.jsx("td",{children:"上下反転が有効なときのみ表示"}),d.jsx("td",{children:d.jsx("code",{children:"hair:flipy"})})]}),d.jsxs("tr",{children:[d.jsx("td",{children:d.jsx("code",{children:":flipxy"})}),d.jsx("td",{children:"末尾"}),d.jsx("td",{children:"レイヤー / グループ"}),d.jsx("td",{children:"左右・上下両方の反転が有効なときのみ表示"}),d.jsx("td",{children:d.jsx("code",{children:"hair:flipxy"})})]}),d.jsxs("tr",{children:[d.jsx("td",{children:"なし"}),d.jsx("td",{children:"—"}),d.jsx("td",{children:"レイヤー / グループ"}),d.jsx("td",{children:"通常レイヤー（PSD の初期状態に従う）"}),d.jsx("td",{children:d.jsx("code",{children:"eye_open"})})]})]})]}),d.jsxs("div",{className:"note",children:[d.jsx("strong",{children:":flip 系レイヤーの動作:"})," ","例えば ",d.jsx("code",{children:"hair"})," と ",d.jsx("code",{children:"hair:flipx"})," を同一グループに置いた場合、 左右反転が有効になると ",d.jsx("code",{children:"hair"})," が非表示・",d.jsx("code",{children:"hair:flipx"})," が表示に自動切り替わります。 反転設定は設定画面の「反転設定」セクションで行います。"]}),d.jsx("h3",{children:"目・口フレームの構成例"}),d.jsxs("p",{children:["目パチと口パクはそれぞれ最大 5 フレーム（0〜4）のレイヤーを使用します。 設定画面でレイヤーにロールを割り当てます（一部のフレームは割り当て省略可）。",d.jsx("strong",{children:"1 フレームに複数のレイヤーを同時割当することも可能です。"})]}),d.jsx("pre",{children:d.jsx("code",{children:`avatar.psd
├── mouth_closed        ← 口: 閉じ   (frame 0)
├── mouth_half          ← 口: 半開き (frame 2)
├── mouth_open          ← 口: 開き   (frame 4)
├── eye_open            ← 目: 開き   (frame 0)  ┐ frame 0 に
├── eye_shine           ← 目: 開き   (frame 0)  ┘ 2 枚同時割当
├── eye_half            ← 目: 半開き (frame 2)
├── eye_closed          ← 目: 閉じ   (frame 4)
└── !body               ← 固定レイヤー（常時表示）`})}),d.jsx("p",{children:"割り当てていないフレームは最近傍補間で埋められます（例: frame 1 未割り当て → frame 0 のレイヤーを使用）。"})]}),d.jsxs("section",{children:[d.jsx("h2",{children:"設定画面"}),d.jsx("p",{children:"プラグイン一覧の歯車アイコンから設定画面を開きます。 設定はリアルタイムでプレビューに反映されます。"}),d.jsx("h3",{children:"レイヤーツリー"}),d.jsx("p",{children:"PSD 読み込み後にレイヤーツリーが表示されます。グループ名をクリックすると折りたたみ／展開できます。 各レイヤーに対して以下の操作が可能です:"}),d.jsxs("ul",{children:[d.jsxs("li",{children:[d.jsx("strong",{children:"表示切り替え"})," — チェックボックス（通常）またはラジオボタン（",d.jsx("code",{children:"*"})," レイヤー）で表示状態を設定"]}),d.jsxs("li",{children:[d.jsx("strong",{children:"ロール割り当て"})," — ",d.jsx("code",{children:"+"})," ドロップダウンで目・口フレームのロールを追加。 同じレイヤーに複数ロールを割り当て可能。1 フレームに複数レイヤーも割り当て可能"]}),d.jsxs("li",{children:[d.jsx("strong",{children:"flip バッジ"})," — ",d.jsx("code",{children:":flipx"})," 等のサフィックスを持つレイヤーにはバッジが表示される"]})]}),d.jsx("h3",{children:"PSD ファイル"}),d.jsxs("table",{children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{children:"項目"}),d.jsx("th",{children:"説明"}),d.jsx("th",{children:"デフォルト"})]})}),d.jsx("tbody",{children:d.jsxs("tr",{children:[d.jsx("td",{children:"パス"}),d.jsx("td",{children:"プラグインディレクトリからの相対パス"}),d.jsx("td",{children:d.jsx("code",{children:"models/default.psd"})})]})})]}),d.jsx("h3",{children:"VOICEVOX 設定"}),d.jsxs("table",{children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{children:"項目"}),d.jsx("th",{children:"範囲"}),d.jsx("th",{children:"デフォルト"})]})}),d.jsxs("tbody",{children:[d.jsxs("tr",{children:[d.jsx("td",{children:"API ホスト"}),d.jsx("td",{children:"—"}),d.jsx("td",{children:d.jsx("code",{children:"http://localhost:50021"})})]}),d.jsxs("tr",{children:[d.jsx("td",{children:"スピーカー"}),d.jsx("td",{children:"—"}),d.jsx("td",{children:"0"})]}),d.jsxs("tr",{children:[d.jsx("td",{children:"速度"}),d.jsx("td",{children:"0.5 〜 2.0"}),d.jsx("td",{children:"1.0"})]}),d.jsxs("tr",{children:[d.jsx("td",{children:"音量"}),d.jsx("td",{children:"0 〜 2.0"}),d.jsx("td",{children:"1.0"})]})]})]}),d.jsx("h3",{children:"口パクパラメータ"}),d.jsxs("table",{children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{children:"項目"}),d.jsx("th",{children:"説明"}),d.jsx("th",{children:"デフォルト"})]})}),d.jsxs("tbody",{children:[d.jsxs("tr",{children:[d.jsx("td",{children:"しきい値 (0〜1)"}),d.jsx("td",{children:"音声の RMS がこの値を超えると「発話中」と判定"}),d.jsx("td",{children:"0.15"})]}),d.jsxs("tr",{children:[d.jsx("td",{children:"閉口遅延（フレーム数）"}),d.jsx("td",{children:"無音が続いてから口を閉じ始めるまでの猶予フレーム数。短い無音でも口が閉じないようにする"}),d.jsx("td",{children:"8"})]}),d.jsxs("tr",{children:[d.jsx("td",{children:"口パク速度（遷移フレーム数）"}),d.jsx("td",{children:"口の開口・閉口アニメーションに要するフレーム数（小さいほど速い）"}),d.jsx("td",{children:"4"})]})]})]}),d.jsxs("div",{className:"note",children:[d.jsx("strong",{children:"口パクの仕組み:"})," ","音量しきい値で発話の ON/OFF を判定し、開始・終了時に中間フレームを使ってなめらかにアニメーションします。 発話中は口を開いた状態を維持し、閉口中に発話が再開した場合は即座に開口アニメーションへ切り替わります。"]}),d.jsx("h3",{children:"目パチパラメータ"}),d.jsxs("table",{children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{children:"項目"}),d.jsx("th",{children:"説明"}),d.jsx("th",{children:"デフォルト"})]})}),d.jsxs("tbody",{children:[d.jsxs("tr",{children:[d.jsx("td",{children:"目パチ間隔（秒）"}),d.jsx("td",{children:"瞬きの平均間隔（±20% のジッターを加えてランダム化）"}),d.jsx("td",{children:"3"})]}),d.jsxs("tr",{children:[d.jsx("td",{children:"目パチ速度（遷移フレーム数）"}),d.jsx("td",{children:"閉じる・開くそれぞれに要するフレーム数"}),d.jsx("td",{children:"6"})]})]})]}),d.jsx("h3",{children:"反転設定"}),d.jsxs("table",{children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{children:"項目"}),d.jsx("th",{children:"説明"})]})}),d.jsxs("tbody",{children:[d.jsxs("tr",{children:[d.jsx("td",{children:"左右反転"}),d.jsxs("td",{children:[d.jsx("code",{children:":flipx"})," レイヤーを表示し、対応するベースレイヤーを非表示にする"]})]}),d.jsxs("tr",{children:[d.jsx("td",{children:"上下反転"}),d.jsxs("td",{children:[d.jsx("code",{children:":flipy"})," レイヤーを表示し、対応するベースレイヤーを非表示にする"]})]})]})]}),d.jsx("h3",{children:"テスト発話"}),d.jsx("p",{children:"プレビュー右下のテキスト欄に文章を入力して「話す」ボタンを押すと、 設定中の VOICEVOX パラメータで試し読み上げができます。 「アニメーション」チェックボックスをオンにするとプレビューで目パチが動作します。"})]}),d.jsxs("section",{children:[d.jsx("h2",{children:"レンダリングの仕組み"}),d.jsx("p",{children:"Canvas 描画は PSD レイヤーを z-order 順に処理します。 目・口フレームレイヤーを動的レイヤーとして扱い、 その前後の静的レイヤー群をセグメント（オフスクリーン Canvas）にキャッシュします。"}),d.jsx("pre",{children:d.jsx("code",{children:`描画順（z-order 維持）:
  segment[0]       ← 静的レイヤー群（事前合成キャッシュ）
  eye frame N      ← 現在の目フレーム（動的・複数レイヤー可）
  segment[1]       ← 目の上に重なる静的レイヤー（例: メガネ）
  mouth frame M    ← 現在の口フレーム（動的・複数レイヤー可）
  segment[2]       ← 口の上に重なる静的レイヤー`})}),d.jsx("p",{children:"これにより、目・口レイヤーの前後に固定レイヤーがあっても PSD 本来の z-order が正確に再現されます。"}),d.jsx("h3",{children:"命名規則のレンダリング優先度"}),d.jsxs("ol",{children:[d.jsxs("li",{children:[d.jsx("code",{children:"!"}),"（forceVisible）— 他のすべてのルールより優先して常に描画"]}),d.jsxs("li",{children:["祖先グループが ",d.jsx("code",{children:"layerVisibility"})," で非表示 — 子孫を描画しない"]}),d.jsxs("li",{children:[d.jsx("code",{children:":flip"})," 系 — 反転状態に応じてベースレイヤーと差し替え"]}),d.jsxs("li",{children:[d.jsx("code",{children:"*"}),"（ラジオ）— 同一親グループ内で最初の 1 枚のみ描画"]}),d.jsxs("li",{children:["通常 — ",d.jsx("code",{children:"layerVisibility"})," 設定 or PSD の初期状態"]})]})]}),d.jsxs("section",{children:[d.jsx("h2",{children:"OBS への設定"}),d.jsxs("ol",{className:"steps",children:[d.jsxs("li",{children:[d.jsx("strong",{children:"VOICEVOX を起動"}),d.jsx("br",{}),"VOICEVOX を起動して API サーバーが動作していることを確認します（デフォルト: ",d.jsx("code",{children:"http://localhost:50021"}),"）。"]}),d.jsxs("li",{children:[d.jsx("strong",{children:"OBS にブラウザソースを追加"}),d.jsx("br",{}),"URL: ",d.jsx("code",{children:"http://localhost:3939/plugins/psd-avatar/overlay/"}),d.jsx("br",{}),"幅・高さを PSD ファイルのサイズに合わせます。カスタム CSS は空で OK。"]}),d.jsxs("li",{children:[d.jsx("strong",{children:"設定画面で PSD とレイヤーを設定"}),d.jsx("br",{}),"NicomView の設定画面で PSD ファイルを読み込み、各フレームにレイヤーを割り当てます。"]})]})]})]})}s.createRoot(document.getElementById("root")).render(d.jsx(r,{}));
