import{j as s,L as e,c as d}from"./style.js";function r(){return s.jsxs(e,{title:"PSD アバター",children:[s.jsx("h1",{children:"PSD アバタープラグイン"}),s.jsxs("section",{children:[s.jsx("h2",{children:"概要"}),s.jsx("p",{children:"PSD ファイルを使って 2D アバターを表示するプラグインです。 VOICEVOX でコメントを読み上げながら、音声に合わせた口パクと自動目パチを行います。"}),s.jsxs("ul",{children:[s.jsx("li",{children:"PSD レイヤーを Canvas に合成して描画"}),s.jsx("li",{children:"目パチアニメーション（間隔・速度を設定可能）"}),s.jsx("li",{children:"VOICEVOX 読み上げに連動した口パク（開口・閉口アニメーション）"}),s.jsx("li",{children:"各レイヤーの表示/非表示をプレビューしながら設定"})]}),s.jsxs("div",{className:"note",children:[s.jsx("strong",{children:"必要なもの:"})," VOICEVOX が起動している必要があります。"," ",s.jsx("a",{href:"https://voicevox.hiroshiba.jp/",children:"公式サイト"})," からダウンロードできます。"]})]}),s.jsxs("section",{children:[s.jsx("h2",{children:"PSD ファイルの準備"}),s.jsxs("p",{children:["PSD ファイルはプラグインディレクトリの ",s.jsx("code",{children:"models/"})," ","フォルダに配置します。レイヤー名の先頭に特殊文字を付けることで動作を制御できます。"]}),s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"プレフィックス"}),s.jsx("th",{children:"効果"}),s.jsx("th",{children:"例"})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:s.jsx("code",{children:"!"})}),s.jsx("td",{children:"常に表示（設定 UI での非表示切り替え不可）"}),s.jsx("td",{children:s.jsx("code",{children:"!body"})})]}),s.jsxs("tr",{children:[s.jsx("td",{children:s.jsx("code",{children:"*"})}),s.jsx("td",{children:"ラジオ選択（同グループ内で 1 枚のみ表示）"}),s.jsx("td",{children:s.jsx("code",{children:"*outfit_a"})})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"なし"}),s.jsx("td",{children:"通常レイヤー（PSD の初期状態に従う）"}),s.jsx("td",{children:s.jsx("code",{children:"eye_open"})})]})]})]}),s.jsx("h3",{children:"目・口フレームの構成例"}),s.jsx("p",{children:"目パチと口パクはそれぞれ最大 5 フレームのレイヤーを使用します。 設定画面でレイヤーにロールを割り当てます（一部のフレームは割り当て省略可）。"}),s.jsx("pre",{children:s.jsx("code",{children:`avatar.psd
├── mouth_closed      ← 口: 閉じ   (frame 0)
├── mouth_half        ← 口: 半開き (frame 2)
├── mouth_open        ← 口: 開き   (frame 4)
├── eye_open          ← 目: 開き   (frame 0)
├── eye_half          ← 目: 半開き (frame 2)
├── eye_closed        ← 目: 閉じ   (frame 4)
└── body              ← 固定レイヤー`})}),s.jsx("p",{children:"割り当てていないフレームは最近傍補間で埋められます（例: frame 1 未割り当て→ frame 0 のレイヤーを使用）。"})]}),s.jsxs("section",{children:[s.jsx("h2",{children:"設定画面"}),s.jsx("p",{children:"プラグイン一覧の歯車アイコンから設定画面を開きます。 設定はリアルタイムでプレビューに反映されます。"}),s.jsx("h3",{children:"PSD ファイル"}),s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"項目"}),s.jsx("th",{children:"説明"}),s.jsx("th",{children:"デフォルト"})]})}),s.jsx("tbody",{children:s.jsxs("tr",{children:[s.jsx("td",{children:"パス"}),s.jsx("td",{children:"プラグインディレクトリからの相対パス"}),s.jsx("td",{children:s.jsx("code",{children:"models/default.psd"})})]})})]}),s.jsx("p",{children:"「読み込み」ボタンを押すと PSD をパースしてレイヤーツリーが表示されます。 各レイヤーの表示/非表示の切り替えと、目・口フレームへのロール割り当てができます。"}),s.jsx("h3",{children:"VOICEVOX 設定"}),s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"項目"}),s.jsx("th",{children:"範囲"}),s.jsx("th",{children:"デフォルト"})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:"API ホスト"}),s.jsx("td",{children:"—"}),s.jsx("td",{children:s.jsx("code",{children:"http://localhost:50021"})})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"スピーカー"}),s.jsx("td",{children:"—"}),s.jsx("td",{children:"0"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"速度"}),s.jsx("td",{children:"0.5 〜 2.0"}),s.jsx("td",{children:"1.0"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"音量"}),s.jsx("td",{children:"0 〜 2.0"}),s.jsx("td",{children:"1.0"})]})]})]}),s.jsx("h3",{children:"口パクパラメータ"}),s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"項目"}),s.jsx("th",{children:"説明"}),s.jsx("th",{children:"デフォルト"})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:"しきい値 (0〜1)"}),s.jsx("td",{children:"音声の RMS がこの値を超えると「発話中」と判定"}),s.jsx("td",{children:"0.15"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"閉口遅延（フレーム数）"}),s.jsx("td",{children:"無音が続いてから口を閉じ始めるまでの猶予フレーム数。短い無音でも口が閉じないようにする"}),s.jsx("td",{children:"8"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"口パク速度（遷移フレーム数）"}),s.jsx("td",{children:"口の開口・閉口アニメーションに要するフレーム数（小さいほど速い）"}),s.jsx("td",{children:"4"})]})]})]}),s.jsxs("div",{className:"note",children:[s.jsx("strong",{children:"口パクの仕組み:"})," ","音量しきい値で発話の ON/OFF を判定し、開始・終了時に中間フレームを使ってなめらかにアニメーションします。 発話中は口を開いた状態を維持し、閉口中に発話が再開した場合は即座に開口アニメーションへ切り替わります。"]}),s.jsx("h3",{children:"目パチパラメータ"}),s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"項目"}),s.jsx("th",{children:"説明"}),s.jsx("th",{children:"デフォルト"})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:"目パチ間隔（秒）"}),s.jsx("td",{children:"瞬きの平均間隔（±20% のジッターを加えてランダム化）"}),s.jsx("td",{children:"3"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"目パチ速度（遷移フレーム数）"}),s.jsx("td",{children:"閉じる・開くそれぞれに要するフレーム数"}),s.jsx("td",{children:"6"})]})]})]}),s.jsx("h3",{children:"テスト発話"}),s.jsx("p",{children:"プレビュー右下のテキスト欄に文章を入力して「話す」ボタンを押すと、 設定中の VOICEVOX パラメータで試し読み上げができます。 「アニメーション」チェックボックスをオンにするとプレビューで目パチが動作します。"})]}),s.jsxs("section",{children:[s.jsx("h2",{children:"レンダリングの仕組み"}),s.jsx("p",{children:"Canvas 描画は PSD レイヤーを z-order 順に処理します。 目・口フレームレイヤーを動的レイヤーとして扱い、 その前後の静的レイヤー群をセグメント（オフスクリーン Canvas）にキャッシュします。"}),s.jsx("pre",{children:s.jsx("code",{children:`描画順（z-order 維持）:
  segment[0]       ← 静的レイヤー群（事前合成キャッシュ）
  eye frame N      ← 現在の目フレーム（動的）
  segment[1]       ← 目の上に重なる静的レイヤー（例: メガネ）
  mouth frame M    ← 現在の口フレーム（動的）
  segment[2]       ← 口の上に重なる静的レイヤー`})}),s.jsx("p",{children:"これにより、目・口レイヤーの前後に固定レイヤーがあっても PSD 本来の z-order が正確に再現されます。"})]}),s.jsxs("section",{children:[s.jsx("h2",{children:"OBS への設定"}),s.jsxs("ol",{className:"steps",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"VOICEVOX を起動"}),s.jsx("br",{}),"VOICEVOX を起動してAPIサーバーが動作していることを確認します（デフォルト: ",s.jsx("code",{children:"http://localhost:50021"}),"）。"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"OBS にブラウザソースを追加"}),s.jsx("br",{}),"URL: ",s.jsx("code",{children:"http://localhost:3939/plugins/psd-avatar/overlay/"}),s.jsx("br",{}),"幅・高さを PSD ファイルのサイズに合わせます。カスタム CSS は空で OK。"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"設定画面で PSD とレイヤーを設定"}),s.jsx("br",{}),"NicomView の設定画面で PSD ファイルを読み込み、各フレームにレイヤーを割り当てます。"]})]})]})]})}d.createRoot(document.getElementById("root")).render(s.jsx(r,{}));
